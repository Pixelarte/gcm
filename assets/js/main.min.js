function init() {
    console.info("followMe @PixelarteCl"), initServiceWorker();
}

function initServiceWorker() {
    function a() {
        return "showNotification" in ServiceWorkerRegistration.prototype ? "denied" === Notification.permission ? void console.warn("The user has blocked notifications.") : "PushManager" in window ? void navigator.serviceWorker.ready.then(function(a) {
            reg = a, console.log(a), a.pushManager.getSubscription().then(function(a) {
                return console.log(a), sub = a, a ? (sliceEndPoint(sub.endpoint), isSubscribed = !0, 
                void initButtonSubscribe()) : (isSubscribed = !1, void initButtonSubscribe());
            })["catch"](function(a) {
                console.warn("Error during getSubscription()", a);
            });
        }) : void console.warn("Push messaging isn't supported.") : void console.warn("Notifications aren't supported.");
    }
    "serviceWorker" in navigator ? (console.info("Service Worker is supported"), navigator.serviceWorker.register("/gcm/sw.min.js").then(a)) : console.warn("Service workers aren't supported in this browser.");
}

function initButtonSubscribe() {
    $("#subscribe").show(), isSubscribed ? $("#subscribe").html("Unsubscribe") : $("#subscribe").html("Subscribe"), 
    $("#subscribe").on("click", function(a) {
        a.preventDefault(), isSubscribed ? ($("#subscribe").html("Subscribe"), sub.unsubscribe().then(function(a) {
            $("#subscribe").html("Subscribe"), console.log("Unsubscribed!", a), isSubscribed = !1, 
            dessubscribir();
        })["catch"](function(a) {
            console.log("Error unsubscribing", a), $("#subscribe").html("Subscribe");
        })) : ($("#subscribe").html("Unsubscribe"), reg.pushManager.subscribe({
            userVisibleOnly: !0
        }).then(function(a) {
            sub = a, isSubscribed = !0, console.info("Subscribed! Endpoint:", sub.endpoint), 
            sliceEndPoint(sub.endpoint), subscribir();
        }));
    });
}

function subscribir() {
    $.ajax({
        url: "php/subscribe.php",
        data: {
            campos: {
                endpoints: endpoint,
                dispositivo: dispositivo,
                num: num
            }
        },
        type: "POST",
        dataType: "json",
        success: function(a) {
            console.log(a.result), "ok" == a.result;
        }
    });
}

function dessubscribir() {
    $.ajax({
        url: "php/unSubscribing.php",
        data: {
            campos: {
                endpoints: endpoint,
                num: num
            }
        },
        type: "POST",
        dataType: "json",
        success: function(a) {
            console.log(a.result), "ok" == a.result;
        }
    });
}

function sliceEndPoint(a) {
    endpoint = a.slice(a.indexOf("send/") + 5, a.length), console.log(endpoint);
}

var reg, sub, isSubscribed, endpoint;

window.onload = init;